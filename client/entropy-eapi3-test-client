import sys
sys.path.insert(0,'../libraries')
from entropy.client.services.system.interfaces import Client as SystemSocketClientInterface
from entropy.client.services.ugc.commands import Client as RepositorySocketClientCommands
from entropy.client.interfaces import Client as EquoInterface
from entropyConstants import *
repository = 'sabayonlinux.org'
Entropy = EquoInterface()
dburl = Entropy.SystemSettings['repositories']['available'][repository]['plain_database'].split("/")[2]
port = Entropy.SystemSettings['repositories']['available'][repository]['service_port']

ssl_ca_cert = "/etc/entropy/certs/sabayonlinux.org.crt"
ssl_cert = "/etc/entropy/certs/sabayonlinux.org.server.crt"
eapi3_socket = SystemSocketClientInterface(Entropy, RepositorySocketClientCommands, ssl = True)# , server_ca_cert = ssl_ca_cert, server_cert = ssl_cert)
eapi3_socket.connect(dburl, port+1)

username = 'lxnay'
password = 'xxxx'
session_id = eapi3_socket.open_session()
print "logged in?",eapi3_socket.CmdInterface.service_login(username, password, session_id)
print "logging out...",eapi3_socket.CmdInterface.service_logout(username, session_id)
eapi3_socket.close_session(session_id)
eapi3_socket.disconnect()
